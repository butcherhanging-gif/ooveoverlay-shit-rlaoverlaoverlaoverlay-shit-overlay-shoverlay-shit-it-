<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Valorant RR Overlay - Standalone</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@600;800;900&display=swap" rel="stylesheet">

<style>
:root {
    --accent: #3cff7a;
    --rr-percent: 0%;
    --win: #3cff7a;
    --loss: #ff4c4c;
}

* { margin: 0; padding: 0; box-sizing: border-box; }

html, body {
    height: 100%;
    background: transparent;
    font-family: 'Montserrat', sans-serif;
}

body {
    display: flex;
    justify-content: center;
    align-items: center;
}

/* ===== CARD ===== */
.card {
    width: 1280px;
    height: 260px;
    border-radius: 160px;
    padding: 34px 60px;
    display: flex;
    align-items: center;
    position: relative;
    overflow: hidden;
    outline: 3px solid rgba(0,0,0,0.9);
    backdrop-filter: blur(18px);
    box-shadow: 0 0 0 5px rgba(0,0,0,0.85), 0 0 70px rgba(0,0,0,0.95);
}

/* Rank-specific backgrounds */
.rank-bg-default {
    background: linear-gradient(90deg, rgba(120,20,30,0.7), rgba(20,30,30,0.95) 45%, rgba(0,120,100,0.65));
}
.rank-bg-radiant {
    background: linear-gradient(90deg, rgba(255,210,74,0.4), rgba(20,30,30,0.95) 45%, rgba(255,210,74,0.3));
}
.rank-bg-immortal {
    background: linear-gradient(90deg, rgba(255,92,92,0.5), rgba(20,30,30,0.95) 45%, rgba(255,92,92,0.4));
}
.rank-bg-ascendant {
    background: linear-gradient(90deg, rgba(60,255,122,0.4), rgba(20,30,30,0.95) 45%, rgba(60,255,122,0.3));
}
.rank-bg-diamond {
    background: linear-gradient(90deg, rgba(96,165,255,0.4), rgba(20,30,30,0.95) 45%, rgba(96,165,255,0.3));
}
.rank-bg-platinum {
    background: linear-gradient(90deg, rgba(61,217,217,0.4), rgba(20,30,30,0.95) 45%, rgba(61,217,217,0.3));
}
.rank-bg-gold {
    background: linear-gradient(90deg, rgba(230,184,77,0.4), rgba(20,30,30,0.95) 45%, rgba(230,184,77,0.3));
}

/* Light sweep */
.card::after {
    content: "";
    position: absolute;
    inset: 0;
    background: linear-gradient(120deg, transparent 35%, rgba(255,255,255,0.06), transparent 65%);
    animation: sweep 10s linear infinite;
    pointer-events: none;
}

/* Particle layer */
.particles {
    position: absolute;
    inset: 0;
    pointer-events: none;
    overflow: hidden;
}

.particle {
    position: absolute;
    width: 4px;
    height: 4px;
    border-radius: 50%;
    background: rgba(255,255,255,0.2);
    animation: float-particle 8s ease-in-out infinite;
}

/* Flash effects */
.win-flash {
    position: absolute;
    inset: 0;
    background: radial-gradient(circle at center, rgba(60,255,120,0.6) 0%, transparent 70%);
    animation: win-flash 0.8s ease-out forwards;
    pointer-events: none;
    opacity: 0;
}

.loss-flash {
    position: absolute;
    inset: 0;
    background: linear-gradient(90deg, transparent, rgba(255,76,76,0.4) 20%, transparent 40%, rgba(255,76,76,0.3) 60%, transparent 80%);
    animation: loss-flash 0.6s ease-out forwards;
    pointer-events: none;
    opacity: 0;
}

.win-flash.active, .loss-flash.active {
    opacity: 1;
}

/* Promo glow */
.promo-glow {
    position: absolute;
    inset: 0;
    border-radius: 160px;
    pointer-events: none;
    animation: heartbeat 2s ease-in-out infinite;
    opacity: 0;
}

.promo-glow.active {
    opacity: 1;
}

@keyframes sweep {
    from { transform: translateX(-100%); }
    to { transform: translateX(100%); }
}

@keyframes pulse {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.07); }
}

@keyframes heartbeat {
    0%, 100% { transform: scale(1); opacity: 0.6; }
    50% { transform: scale(1.03); opacity: 1; }
}

@keyframes float-particle {
    0% { transform: translateY(0) translateX(0) rotate(0deg); opacity: 0; }
    20% { opacity: 0.6; }
    80% { opacity: 0.6; }
    100% { transform: translateY(-100px) translateX(50px) rotate(180deg); opacity: 0; }
}

@keyframes win-flash {
    0% { opacity: 0; transform: scale(0.5); }
    50% { opacity: 1; transform: scale(1.2); }
    100% { opacity: 0; transform: scale(1.5); }
}

@keyframes loss-flash {
    0% { opacity: 0; }
    20% { opacity: 1; }
    40% { opacity: 0.3; }
    60% { opacity: 1; }
    80% { opacity: 0.3; }
    100% { opacity: 0; }
}

@keyframes name-glow {
    0% { text-shadow: 0 0 10px currentColor; }
    50% { text-shadow: 0 0 30px currentColor, 0 0 60px currentColor; }
    100% { text-shadow: 0 0 10px currentColor; }
}

/* ===== LEFT ===== */
.left {
    display: flex;
    align-items: center;
    z-index: 2;
}

.rank-wrap {
    position: relative;
    width: 130px;
    height: 130px;
    margin-right: 32px;
}

.rank-ring {
    position: absolute;
    inset: -10px;
    border-radius: 50%;
    background: conic-gradient(var(--accent) var(--rr-percent), rgba(255,255,255,0.1) 0);
    transition: background 0.3s ease;
}

.rank-ring.promo {
    animation: heartbeat 2s ease-in-out infinite;
}

.rank-ring-inner {
    position: absolute;
    inset: 0;
    border-radius: 50%;
    background: rgba(0,0,0,0.8);
}

#rank-icon {
    width: 130px;
    height: 130px;
    position: relative;
    z-index: 2;
    filter: drop-shadow(0 0 35px rgba(0,0,0,0.95));
}

.rank-glow {
    position: absolute;
    inset: 0;
    border-radius: 50%;
    filter: blur(20px);
    opacity: 0.3;
    animation: heartbeat 2s ease-in-out infinite;
}

/* ===== TEXT ===== */
.info {
    color: white;
}

.rank-name {
    font-size: 38px;
    font-weight: 800;
    transition: color 0.3s ease;
}

.rr {
    font-size: 96px;
    font-weight: 900;
    line-height: 1;
    transition: transform 0.3s ease;
}

.rr.pulse {
    animation: pulse 0.8s ease;
}

.rr-progress {
    font-size: 14px;
    font-weight: 600;
    color: rgba(255,255,255,0.6);
    margin-top: 4px;
}

/* ===== STATS ===== */
.stats {
    display: flex;
    gap: 14px;
    margin-top: 12px;
}

.badge {
    min-width: 80px;
    padding: 10px 22px;
    border-radius: 999px;
    font-size: 22px;
    font-weight: 800;
    text-align: center;
    background: rgba(0,0,0,0.6);
    box-shadow: inset 0 0 0 1px rgba(255,255,255,0.08), 0 0 14px rgba(0,0,0,0.9);
}

.badge.win {
    color: var(--win);
    background: linear-gradient(180deg, rgba(60,255,120,0.3), rgba(0,0,0,0.6));
}

.badge.loss {
    color: var(--loss);
    background: linear-gradient(180deg, rgba(255,80,80,0.3), rgba(0,0,0,0.6));
}

.badge.last {
    min-width: 120px;
}

.badge.net {
    min-width: 120px;
}

/* ===== RIGHT ===== */
.right {
    margin-left: auto;
    text-align: right;
    z-index: 2;
    opacity: 0.9;
}

.user {
    font-size: 28px;
    font-weight: 800;
    transition: text-shadow 0.3s ease, color 0.3s ease;
}

.user.glow {
    animation: name-glow 1s ease-out;
}

.region {
    margin-top: 6px;
    font-size: 18px;
    letter-spacing: 2px;
    opacity: 0.8;
}

.mode {
    margin-top: 16px;
    font-size: 15px;
    letter-spacing: 1px;
    opacity: 0.6;
}

/* ===== CONFIG PANEL ===== */
.config-panel {
    position: fixed;
    top: 20px;
    right: 20px;
    background: rgba(20,25,30,0.95);
    padding: 20px;
    border-radius: 12px;
    z-index: 100;
    min-width: 300px;
    box-shadow: 0 10px 40px rgba(0,0,0,0.5);
}

.config-panel h2 {
    color: #3cff7a;
    margin-bottom: 15px;
    font-size: 18px;
}

.config-panel label {
    display: block;
    color: #888;
    font-size: 12px;
    margin-bottom: 4px;
    margin-top: 10px;
}

.config-panel input, .config-panel select {
    width: 100%;
    padding: 10px;
    border: 1px solid #333;
    border-radius: 6px;
    background: #1a1f24;
    color: white;
    font-size: 14px;
}

.config-panel button {
    width: 100%;
    padding: 12px;
    margin-top: 15px;
    border: none;
    border-radius: 6px;
    background: #3cff7a;
    color: #111;
    font-weight: 700;
    cursor: pointer;
    transition: background 0.2s;
}

.config-panel button:hover {
    background: #2de66a;
}

.config-panel .secondary-btn {
    background: #333;
    color: white;
    margin-top: 8px;
}

.config-panel .secondary-btn:hover {
    background: #444;
}

.hide-config .config-panel {
    display: none;
}

.status {
    margin-top: 10px;
    padding: 8px;
    border-radius: 4px;
    font-size: 12px;
    text-align: center;
}

.status.success {
    background: rgba(60,255,120,0.2);
    color: #3cff7a;
}

.status.error {
    background: rgba(255,76,76,0.2);
    color: #ff4c4c;
}
</style>
</head>

<body>

<div class="card rank-bg-default" id="card">
    <!-- Flash effects -->
    <div class="win-flash" id="win-flash"></div>
    <div class="loss-flash" id="loss-flash"></div>
    
    <!-- Promo glow -->
    <div class="promo-glow" id="promo-glow"></div>
    
    <!-- Particles -->
    <div class="particles" id="particles"></div>

    <div class="left">
        <div class="rank-wrap">
            <div class="rank-ring" id="rank-ring"></div>
            <div class="rank-ring-inner"></div>
            <img id="rank-icon" alt="Rank">
            <div class="rank-glow" id="rank-glow"></div>
        </div>

        <div class="info">
            <div class="rank-name" id="rank-name">Loading...</div>
            <div class="rr" id="rr">0 RR</div>
            <div class="rr-progress" id="rr-progress">-- RR TO NEXT RANK</div>

            <div class="stats">
                <div class="badge win" id="wins">0W</div>
                <div class="badge loss" id="losses">0L</div>
                <div class="badge last" id="last">Last: --</div>
                <div class="badge net" id="net">Net: +0</div>
            </div>
        </div>
    </div>

    <div class="right">
        <div class="user" id="user">Username#Tag</div>
        <div class="region" id="region">REGION</div>
        <div class="mode">COMPETITIVE • LIVE</div>
    </div>
</div>

<!-- Config Panel -->
<div class="config-panel" id="config-panel">
    <h2>⚡ VALORANT RR OVERLAY</h2>
    
    <label>API Key (from henrikdev.xyz)</label>
    <input type="text" id="api-key" placeholder="HDEV-xxxx-xxxx-xxxx">
    
    <label>Username</label>
    <input type="text" id="username" placeholder="Hawt Babies">
    
    <label>Tag</label>
    <input type="text" id="tag" placeholder="ecurB">
    
    <label>Region</label>
    <select id="region-select">
        <option value="na">North America</option>
        <option value="eu">Europe</option>
        <option value="ap" selected>Asia Pacific</option>
        <option value="kr">Korea</option>
        <option value="latam">Latin America</option>
        <option value="br">Brazil</option>
    </select>
    
    <label>Platform</label>
    <select id="platform">
        <option value="pc" selected>PC</option>
        <option value="console">Console</option>
    </select>
    
    <button onclick="saveConfig()">Start Tracking</button>
    <button class="secondary-btn" onclick="resetSession()">Reset Session</button>
    <button class="secondary-btn" onclick="toggleConfig()">Hide Panel</button>
    
    <div class="status" id="status"></div>
</div>

<script>
/* ===== CONFIG ===== */
let CONFIG = JSON.parse(localStorage.getItem('valorant_config')) || {
    apiKey: '',
    username: '',
    tag: '',
    region: 'ap',
    platform: 'pc'
};

/* ===== STATE ===== */
let state = JSON.parse(localStorage.getItem('valorant_state')) || {
    prevElo: null,
    wins: 0,
    losses: 0,
    lastChange: null,
    startingElo: null
};

/* ===== RANK COLORS ===== */
function getAccent(tier) {
    tier = tier.toLowerCase();
    if (tier.includes('radiant')) return '#ffd24a';
    if (tier.includes('immortal')) return '#ff5c5c';
    if (tier.includes('ascendant')) return '#3cff7a';
    if (tier.includes('diamond')) return '#60a5ff';
    if (tier.includes('platinum')) return '#3dd9d9';
    if (tier.includes('gold')) return '#e6b84d';
    if (tier.includes('silver')) return '#b8b8b8';
    if (tier.includes('bronze')) return '#cd7f32';
    if (tier.includes('iron')) return '#6b6b6b';
    return '#cccccc';
}

function getRankBgClass(tier) {
    tier = tier.toLowerCase();
    if (tier.includes('radiant')) return 'rank-bg-radiant';
    if (tier.includes('immortal')) return 'rank-bg-immortal';
    if (tier.includes('ascendant')) return 'rank-bg-ascendant';
    if (tier.includes('diamond')) return 'rank-bg-diamond';
    if (tier.includes('platinum')) return 'rank-bg-platinum';
    if (tier.includes('gold')) return 'rank-bg-gold';
    return 'rank-bg-default';
}

function getNextRank(tierName) {
    const parts = tierName.split(' ');
    const rankName = parts[0];
    const tier = parseInt(parts[1]) || 1;
    
    if (tier < 3) return `${rankName} ${tier + 1}`;
    
    const order = ['Iron', 'Bronze', 'Silver', 'Gold', 'Platinum', 'Diamond', 'Ascendant', 'Immortal', 'Radiant'];
    const idx = order.findIndex(r => rankName.includes(r));
    if (idx >= 0 && idx < order.length - 1) return `${order[idx + 1]} 1`;
    return 'Radiant';
}

function formatRegion(region) {
    const map = { na: 'NORTH AMERICA', eu: 'EUROPE', ap: 'ASIA PACIFIC', kr: 'KOREA', latam: 'LATIN AMERICA', br: 'BRAZIL' };
    return map[region] || region.toUpperCase();
}

/* ===== PARTICLES ===== */
function createParticles() {
    const container = document.getElementById('particles');
    container.innerHTML = '';
    for (let i = 0; i < 8; i++) {
        const p = document.createElement('div');
        p.className = 'particle';
        p.style.left = `${10 + i * 12}%`;
        p.style.top = `${50 + (i % 3) * 20}%`;
        p.style.animationDelay = `${i * 1.2}s`;
        p.style.animationDuration = `${6 + i}s`;
        container.appendChild(p);
    }
}

/* ===== FLASH EFFECTS ===== */
function triggerWinFlash() {
    const el = document.getElementById('win-flash');
    el.classList.add('active');
    setTimeout(() => el.classList.remove('active'), 800);
    
    const user = document.getElementById('user');
    user.classList.add('glow');
    setTimeout(() => user.classList.remove('glow'), 1000);
}

function triggerLossFlash() {
    const el = document.getElementById('loss-flash');
    el.classList.add('active');
    setTimeout(() => el.classList.remove('active'), 600);
}

/* ===== UPDATE OVERLAY ===== */
async function updateOverlay() {
    if (!CONFIG.apiKey || !CONFIG.username || !CONFIG.tag) {
        showStatus('Please configure your settings', 'error');
        return;
    }

    try {
        const url = `https://api.henrikdev.xyz/valorant/v3/mmr/${CONFIG.region}/${CONFIG.platform}/${encodeURIComponent(CONFIG.username)}/${encodeURIComponent(CONFIG.tag)}?api_key=${CONFIG.apiKey}`;
        
        const res = await fetch(url);
        if (!res.ok) throw new Error(`API Error: ${res.status}`);
        
        const data = await res.json();
        if (data.status !== 200) throw new Error(data.errors?.[0]?.message || 'API Error');
        
        const cur = data.data.current;
        const rr = cur.rr;
        const tierName = cur.tier.name;
        const tierId = cur.tier.id;
        const currentElo = cur.elo || 0;
        const lastChangeAPI = cur.last_change ?? cur.mmr_change_to_last_game ?? 0;
        
        const accent = getAccent(tierName);
        const isPromo = rr >= 80;
        
        // Update display
        document.getElementById('rank-name').textContent = tierName;
        document.getElementById('rank-name').style.color = accent;
        document.getElementById('rank-icon').src = `https://media.valorant-api.com/competitivetiers/03621f52-342b-cf4e-4f86-9350a49c6d04/${tierId}/largeicon.png`;
        
        // RR Ring
        document.documentElement.style.setProperty('--accent', accent);
        document.documentElement.style.setProperty('--rr-percent', `${Math.min(rr, 100)}%`);
        document.getElementById('rank-glow').style.backgroundColor = accent;
        
        // Promo range effects
        const rankRing = document.getElementById('rank-ring');
        const promoGlow = document.getElementById('promo-glow');
        if (isPromo) {
            rankRing.classList.add('promo');
            promoGlow.classList.add('active');
            promoGlow.style.boxShadow = `inset 0 0 60px ${accent}40, 0 0 40px ${accent}30`;
        } else {
            rankRing.classList.remove('promo');
            promoGlow.classList.remove('active');
        }
        
        // Dynamic background
        const card = document.getElementById('card');
        card.className = 'card ' + getRankBgClass(tierName);
        
        // RR display
        const rrEl = document.getElementById('rr');
        rrEl.textContent = `${rr} RR`;
        
        // RR to next rank
        document.getElementById('rr-progress').textContent = `${100 - rr} RR TO ${getNextRank(tierName).toUpperCase()}`;
        
        // Initialize state on first run
        if (state.startingElo === null) {
            state.startingElo = currentElo;
            state.prevElo = currentElo;
            state.lastChange = lastChangeAPI;
        }
        
        // Detect new match by ELO change
        if (state.prevElo !== null && currentElo !== state.prevElo) {
            const isWin = currentElo > state.prevElo;
            
            if (isWin) {
                state.wins++;
                triggerWinFlash();
            } else {
                state.losses++;
                triggerLossFlash();
            }
            
            state.lastChange = lastChangeAPI;
            rrEl.classList.add('pulse');
            setTimeout(() => rrEl.classList.remove('pulse'), 800);
        }
        
        state.prevElo = currentElo;
        
        // Update stats display
        document.getElementById('wins').textContent = `${state.wins}W`;
        document.getElementById('losses').textContent = `${state.losses}L`;
        
        // Last change
        const lastEl = document.getElementById('last');
        const displayLast = state.lastChange !== null ? state.lastChange : lastChangeAPI;
        if (displayLast !== 0) {
            lastEl.textContent = `Last: ${displayLast >= 0 ? '+' : ''}${displayLast}`;
            lastEl.style.color = displayLast >= 0 ? 'var(--win)' : 'var(--loss)';
        } else {
            lastEl.textContent = 'Last: --';
            lastEl.style.color = '#eaeaea';
        }
        
        // Net RR
        const netRR = currentElo - state.startingElo;
        const netEl = document.getElementById('net');
        netEl.textContent = `Net: ${netRR >= 0 ? '+' : ''}${netRR}`;
        netEl.style.color = netRR > 0 ? 'var(--win)' : netRR < 0 ? 'var(--loss)' : '#eaeaea';
        
        // User info
        document.getElementById('user').textContent = `${CONFIG.username}#${CONFIG.tag}`;
        document.getElementById('region').textContent = formatRegion(CONFIG.region);
        
        // Save state
        localStorage.setItem('valorant_state', JSON.stringify(state));
        
        showStatus('Updated successfully', 'success');
        
    } catch (e) {
        console.error('Overlay error:', e);
        showStatus(e.message, 'error');
    }
}

/* ===== CONFIG FUNCTIONS ===== */
function saveConfig() {
    CONFIG.apiKey = document.getElementById('api-key').value.trim();
    CONFIG.username = document.getElementById('username').value.trim();
    CONFIG.tag = document.getElementById('tag').value.trim();
    CONFIG.region = document.getElementById('region-select').value;
    CONFIG.platform = document.getElementById('platform').value;
    
    if (!CONFIG.apiKey || !CONFIG.username || !CONFIG.tag) {
        showStatus('Please fill all fields', 'error');
        return;
    }
    
    localStorage.setItem('valorant_config', JSON.stringify(CONFIG));
    
    // Reset state for new config
    state = { prevElo: null, wins: 0, losses: 0, lastChange: null, startingElo: null };
    localStorage.setItem('valorant_state', JSON.stringify(state));
    
    updateOverlay();
}

function resetSession() {
    state = { prevElo: null, wins: 0, losses: 0, lastChange: null, startingElo: null };
    localStorage.setItem('valorant_state', JSON.stringify(state));
    updateOverlay();
    showStatus('Session reset!', 'success');
}

function toggleConfig() {
    document.body.classList.toggle('hide-config');
}

function showStatus(msg, type) {
    const el = document.getElementById('status');
    el.textContent = msg;
    el.className = 'status ' + type;
    setTimeout(() => el.textContent = '', 3000);
}

function loadConfig() {
    document.getElementById('api-key').value = CONFIG.apiKey || '';
    document.getElementById('username').value = CONFIG.username || '';
    document.getElementById('tag').value = CONFIG.tag || '';
    document.getElementById('region-select').value = CONFIG.region || 'ap';
    document.getElementById('platform').value = CONFIG.platform || 'pc';
}

/* ===== INIT ===== */
createParticles();
loadConfig();

if (CONFIG.apiKey && CONFIG.username && CONFIG.tag) {
    updateOverlay();
}

// Poll every 30 seconds
setInterval(updateOverlay, 30000);

// URL param to hide config panel (for OBS)
if (new URLSearchParams(window.location.search).get('overlay') === 'true') {
    document.body.classList.add('hide-config');
}
</script>

</body>
</html>
